<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Marmitaria do Zé</title>
  <link rel="stylesheet" href="/css/style.css" th:href="@{/css/style.css}">
  <link rel="stylesheet" href="/css/custom.css" th:href="@{/css/custom.css}">
  <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/3.0.0/uicons-solid-rounded/css/uicons-solid-rounded.css'>
  <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/3.0.0/uicons-regular-rounded/css/uicons-regular-rounded.css'>
</head>
<body>
  <div class="d-flex">
    <div th:replace="fragments/dashboard :: SideBar"></div>

    <div class="pt-4 ps-3" style="flex: 1; overflow: auto;">
      <div class="d-grid" style="grid-template-columns: repeat(4, 1fr); gap: 1rem;">
        <div class="card mx-4 my-3" th:each="product : ${products}">
          <img src="/images/placeholder.jpg" class="card-img-top" alt="..." th:src="@{/images/placeholder.jpg}">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title" th:text="${product.name}"></h5>
            <hr class="mt-0">
            <p class="card-text overflow-scroll object-fit-scale" style="height: 7rem;" th:text="${product.description}"></p>
            <div>
              <p th:text="'$'+${product.price}"></p>
              <a th:href="@{/rating/rate/{id}(id=${product.id})}">Avalie agora</a>
            </div>
            <div class="d-flex justify-content-end">
              <button class="btn btn-light-green text-light" onclick="addtocart(this)" th:attr="data-id=${product.id},data-name=${product.name}">Comprar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    document.getElementById('produtos').classList.add('link-light', 'bg-dark-green');
    document.getElementById('carrinho').classList.add('link-dark');

    function addtocart(btn){
      if(!btn) return;
      const id = btn.getAttribute('data-id');
      if(!id) return;

      const STORAGE_KEY = 'cart';
      let cart = [];
      try{
        cart = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
      }catch(e){
        cart = [];
      }

      // capture product name if available on the button
      const name = btn.getAttribute('data-name') || null;

      const existing = cart.find(item => String(item.id) === String(id));
      if(existing){
        existing.quantity = Number(existing.quantity || 0) + 1;
        // ensure name is present
        if(!existing.name && name) existing.name = name;
      } else {
        const entry = { id: id, quantity: 1 };
        if(name) entry.name = name;
        cart.push(entry);
      }

      localStorage.setItem(STORAGE_KEY, JSON.stringify(cart));

      // small feedback on button
      const original = btn.textContent;
      btn.textContent = 'Adicionado ✓';
      btn.disabled = true;
      setTimeout(() => { btn.textContent = original; btn.disabled = false; }, 800);
    }
  </script>
  <script src="/js/dashboard.js" th:src="@{/js/dashboard.js}"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
</body>
</html> 